<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <title>订单</title>
    <link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <script src="/js/jquery-1.9.1.js"></script>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="http://cdn.static.runoob.com/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="http://cdn.static.runoob.com/libs/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script>
	wx.config({
		debug: false,
		appId: '<%= config.appid %>',
		timestamp: '<%= config.timestamp %>',
		nonceStr: '<%= config.nonceStr %>',
		signature: '<%= config.signature %>',
		jsApiList: ['chooseWXPay','openAddress']

	});
	wx.ready(function() {
		document.querySelector('#openAddress').onclick = function() {
			wx.openAddress({
				success: function(res) {
					var name = $('#name').html('');
			  	var phone = $('#phone').html('');
			  	var address = $('#address').html('');

				  $('#name').html(res.userName);
				  $('#phone').html(res.telNumber);
				  $('#address').html(res.provinceName+res.cityName+res.countryName+res.detailInfo);

				},
				fail: function(res) {
					alert('网络繁忙，请稍后再试！');
				}	
			});	

		};
		document.querySelector('#chooseWXPay').onclick = function() {
			var name = $('#name').text();
		  var phone = $('#phone').text();
		  var address = $('#address').text();
		  if(name && phone && address){
				wx.chooseWXPay({
					timestamp: '<%= data.timeStamp %>',
					nonceStr: '<%= data.nonceStr %>',
					package: '<%= data.package %>',
					signType: '<%= data.signType %>',
					paySign: '<%= data.paySign %>',
					success: function(res) {
						alert('支付成功');
						var name = $('#name').text();
						var address = $('#address').text();
						var phone = $('#phone').text();
						var product = $('#product').text();
						var specifications = '<%= total %>件';
						var money = '<%= pay_money %>';
						var out_trade_no = "<%= data.out_trade_no %>";

						$('#order_openid').val('<%= openid %>');
						$('#order_name').val(name);
						$('#order_address').val(address);
						$('#order_phone').val(phone);
						$('#order_product').val(product);
						$('#order_specifications').val(specifications);
						$('#order_money').val(money);
						$('#order_out_trade_no').val(out_trade_no);
						$('#sub').click();

					},
					fail: function(res) {
						alert('网络繁忙，请稍后再试！');
					}
				});

		  }else{
		  	alert('请输入收获地址');
		  }
		};
	});	
</script>
<form action="/admin/setOrder" method="post" style="visibility: hidden;margin-top: -100px;">
	<input type="text" name="openid" id="order_openid">
	<input type="text" name="name" id="order_name">
	<input type="text" name="address" id="order_address">
	<input type="text" name="phone" id="order_phone">
	<input type="text" name="product" id="order_product">
	<input type="text" name="specifications" id="order_specifications">
	<input type="text" name="pay_money" id="order_money">
	<input type="text" name="out_trade_no" id="order_out_trade_no">
	<input type="submit" id="sub">
</form>

<body>
<!-- 按钮触发模态框 -->
<!-- <button class="btn btn-primary btn-sm" data-toggle="modal" data-target="#newAddress">新建收货地址</button> -->
<button id="openAddress" class="btn btn-primary btn-sm">
	我的收货地址
</button>


  <div class="main">
		<div class="order">
			<div class="order-address">
				<address id="order-address">
 					<p><label id="name"></label><label id="phone"></label></p>
					<p id="address"></p>
				</address>	
			</div>






			<div class="order-item">
				<div class="order-top">订单信息</div>
				<div class="order-center">
					<a href="javascript:" class="order-shoplist">
						<img src="/images/26659155088350080_03.jpg" alt="" />
						<div class="order-shoplist_right">
							<div class="shoplist_title">
								<span id="product">防雾霾窗帖</span>
								<label><%= pay_money %></label>
							</div>
							<span class="shoplist_ms">
								<i>数量：<%= total %>件</i>
								<!-- <i>送达日期：周六送达</i> -->
							</span>
						</div>
					</a>
					<div class="order-number">
						<span>订单号：</span>
						<label><%= data.out_trade_no %></label>
					</div>
				</div>
			</div>
			<div class="order-item">
				<div class="order-top">订单费用</div>
				<div class="order-center">
					<ul>
						<li>
							<span>商品总额：</span>
							<label>￥<%= pay_money %></label>
						</li>
						<li>
							<span>运费：</span>
							<label>￥0.00</label>
						</li>
						<li>
							<span>付款金额：</span>
							<label style="color: #ff4141;">￥<%= pay_money %></label>
						</li>
					</ul>
				</div>
			</div>
			<div class="sum-btn">
				<a class="btn btn-danger btn-block active" id="chooseWXPay">购买</a>
			</div>
		</div>
	</div>
</body>
</html>
